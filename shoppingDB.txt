-- 회원 테이블 
drop table member CASCADE CONSTRAINTS;
CREATE TABLE member (
    id NUMBER PRIMARY KEY,               -- 내부 식별용 회원 고유 ID (자동 증가)
    user_id VARCHAR(100) NOT NULL,                   -- 로그인용 사용자 ID
    password VARCHAR(100) NOT NULL,                  -- 로그인 비밀번호
    name VARCHAR(100),                               -- 실명 (선택적으로 활용 가능)
    phone VARCHAR(100),                              -- 전화번호 (배송 연락용 등)
    address VARCHAR(200),                            -- 배송지 주소
    created_at DATE DEFAULT CURRENT_DATE,        -- 회원 가입일 (기본값: 오늘)
    ROLE varchar(100) DEFAULT 'USER'                --기본 값 USER, 후에 수정으로 관리자 권한 부여 형태로 처리 예정...
);

drop sequence member_seq;
create sequence member_seq;

select * from member;

insert into member(id, user_id ,password,name,phone,address,created_at, ROLE) values (member_seq.nextval,'admin','admin','관리자','010-1111-1111','서울', sysdate, 'ADMIN');

-- 책 테이블
drop table book CASCADE CONSTRAINTS;
CREATE TABLE book (
    id NUMBER PRIMARY KEY,               -- 책 고유 ID (자동 증가)
    title VARCHAR(200) NOT NULL,                     -- 책 제목
    author VARCHAR(100),                             -- 저자 이름
    price INT NOT NULL,                              -- 책 가격
    description VARCHAR(500),                        -- 책 설명/소개글
    image VARCHAR(500),                               -- 책 표지 이미지 경로(URL 또는 파일명)
    stock varchar(500)
);

drop sequence book_seq;
create sequence book_seq;

INSERT INTO BOOK(id, title, author, price, description, image, stock) values(book_seq.nextval, '마지네일리아의 거주자','김지승',25000,'여성적 읽기로 여백을 쓰다','마지네일리아의 거주자.jpg',100);
INSERT INTO BOOK(id, title, author, price, description, image, stock) values(book_seq.nextval, '치유의 빛','강화길',22000,'아무리 발버둥을 치고 몸부림을 쳐도 벗어날 수 없는 나의 몸, 나의 고통, 나의 과거','치유의 빛.jpg',100);
INSERT INTO BOOK(id, title, author, price, description, image, stock) values(book_seq.nextval, '생각의 주도권을 디자인하라','박용후',21000,'AI를 도구를 넘어 무기로 만드는 질문의 힘','생각의 주도권을 디자인하라.jpg',100);
INSERT INTO BOOK(id, title, author, price, description, image, stock) values(book_seq.nextval, '첫 여름, 완주','김금희',15000,'내용 생략','첫 여름, 완주.jpg',100);
INSERT INTO BOOK(id, title, author, price, description, image, stock) values(book_seq.nextval, '소설 보다: 여름 2025','김지연',25000,'내용 생략','소설 보다: 여름 2025.jpg',100);
INSERT INTO BOOK(id, title, author, price, description, image, stock) values(book_seq.nextval, '소크라테스의 변명·크리톤·파이돈·향연(그리스어 원전 완역본)','박문재',25000,'내용 생략','소크라테스의 변명·크리톤·파이돈·향연(그리스어 원전 완역본).jpg',100);
INSERT INTO BOOK(id, title, author, price, description, image, stock) values(book_seq.nextval, '워런 버핏 바이블 2021','이건',25000,'내용 생략','워런 버핏 바이블 2021.jpg',100);
INSERT INTO BOOK(id, title, author, price, description, image, stock) values(book_seq.nextval, '너무 늦은 시간','허진',25000,'내용 생략','너무 늦은 시간.jpg',100);
INSERT INTO BOOK(id, title, author, price, description, image, stock) values(book_seq.nextval, '혼모노','성해나',25000,'내용 생략','혼모노.jpg',100);
INSERT INTO BOOK(id, title, author, price, description, image, stock) values(book_seq.nextval, '가공범','성해나',25000,'내용 생략','가공범.jpg',100);
INSERT INTO BOOK(id, title, author, price, description, image, stock) values(book_seq.nextval, '안녕이라 그랬어','김애란',25000,'내용 생략','안녕이라 그랬어.jpg',100);

select * from book;

-- 장바구니 테이블 
drop table cart CASCADE CONSTRAINTS;
CREATE TABLE cart (
    id NUMBER PRIMARY KEY ,                              -- 장바구니 항목 고유 ID
    member_id INT NOT NULL,                       -- 어떤 사용자의 장바구니인지 (FK → member)
    book_id INT NOT NULL,                           -- 어떤 책을 담았는지 (FK → book)
    quantity INT NOT NULL,                           -- 담은 수량
    added_at DATE DEFAULT CURRENT_DATE,  -- 장바구니에 담은 날짜

    -- 외래 키 설정
    FOREIGN KEY (member_id) REFERENCES member(id),
    FOREIGN KEY (book_id) REFERENCES book(id)
);

drop sequence cart_seq;
create sequence cart_seq;

-- 결제 내역 테이블: 실제 결제된 항목만 저장
drop table ORDERS CASCADE CONSTRAINTS;
CREATE TABLE ORDERS(
    id NUMBER PRIMARY KEY ,                             -- 주문 고유 ID
    member_id INT NOT NULL,                      -- 주문한 회원 (FK → member)
    book_id INT NOT NULL,                          -- 주문한 책 (FK → book)
    quantity INT NOT NULL,                          -- 구매 수량
    total_price INT NOT NULL,                       -- 총 결제 금액 (수량 × 단가)
    order_date DATE DEFAULT CURRENT_DATE, -- 결제일 (기본: 오늘)
    transaction_id VARCHAR2(255) not null,

    FOREIGN KEY (member_id) REFERENCES member(id),
    FOREIGN KEY (book_id) REFERENCES book(id)
);

drop sequence orders_seq;
create sequence orders_seq;


select * from orders;

